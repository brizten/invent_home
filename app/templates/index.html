{% extends 'base.html' %}
{% block content %}
<h2>Вещи</h2>
<form method="get" class="grid" style="grid-template-columns: 1fr 1fr 1fr auto; gap: .5rem; align-items:end;">
  <div>
    <label>Поиск</label>
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Название, место..." />
  </div>
  <div>
    <label>Категория</label>
    <select name="category_id">
      <option value="">Все</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if category_id and c.id == category_id %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Сортировка</label>
    <select name="sort">
      <option value="new" {% if sort=='new' %}selected{% endif %}>Сначала новые</option>
      <option value="name" {% if sort=='name' %}selected{% endif %}>По названию</option>
      <option value="value" {% if sort=='value' %}selected{% endif %}>По стоимости</option>
    </select>
  </div>
  <button type="submit" class="btn">Фильтр</button>
</form>

<table>
  <thead>
    <tr>
      <th>Название</th>
      <th>Категория</th>
      <th>Место</th>
      <th>Кол-во</th>
      <th>Цена</th>
      <th>Дата</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for i in items %}
    <tr>
      <td>
        {% if i.photo_url %}<img src="{{ i.photo_url }}" alt="" class="thumb" />{% endif %}
        <div>
          <div class="bold">{{ i.name }}</div>
          {% if i.notes %}<div class="muted small">{{ i.notes }}</div>{% endif %}
        </div>
      </td>
      <td>{{ i.category_name or '—' }}</td>
      <td>{{ i.location or '—' }}</td>
      <td>{{ i.quantity }} {{ i.unit or '' }}</td>
      <td>{% if i.value is not none %}{{ '%.2f'|format(i.value) }}{% else %}—{% endif %}</td>
      <td>{% if i.purchase_date %}{{ i.purchase_date }}{% else %}—{% endif %}</td>
      <td class="nowrap">
        <a class="btn" href="/items/{{ i.id }}/edit">Изм.</a>
        <form action="/items/{{ i.id }}/delete" method="post" style="display:inline" onsubmit="return confirm('Удалить вещь?');">
          <button class="btn danger" type="submit">Удал.</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if not items %}
  <p class="muted">Пусто. Добавьте первую вещь → <a href="/items/new">добавить</a>.</p>
{% endif %}
{% endblock %}
